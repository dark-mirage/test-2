# Исправление ошибки 403

## Проблема

Ошибка 403 возникает потому, что:
1. Cookie `tg_session` установлен с флагом `httpOnly: true` (для безопасности)
2. JavaScript не может прочитать httpOnly cookie через `document.cookie`
3. Поэтому токен авторизации не передается в запросах

## Решение

Я исправил это следующим образом:

### 1. Публичные эндпоинты работают без авторизации

Следующие эндпоинты теперь работают **без авторизации**:
- ✅ `GET /api/v1/products` - список товаров
- ✅ `GET /api/v1/products/latest` - последние товары
- ✅ `GET /api/v1/products/{id}` - товар по ID
- ✅ `GET /api/v1/categories` - категории
- ✅ `GET /api/v1/types` - типы
- ✅ `GET /api/v1/brands` - бренды
- ✅ `GET /api/v1/brands/search` - поиск брендов

### 2. Создан API route для получения токена

Создан `/api/auth/token` который возвращает токен из httpOnly cookie.

### 3. Создан прокси для запросов с авторизацией

Создан `/api/proxy` для запросов, требующих авторизации.

## Что теперь работает

✅ **Главная страница** - товары загружаются без ошибок 403
✅ **Страница товара** - данные товара загружаются
✅ **Категории и бренды** - загружаются без авторизации

## Что требует авторизации (и будет использовать прокси)

- ❌ Корзина (`/api/v1/cart`) - требует авторизации
- ❌ Избранное (`/api/v1/favorites`) - требует авторизации
- ❌ Заказы (`/api/v1/orders`) - требует авторизации
- ❌ Пользователь (`/api/v1/users`) - требует авторизации

Для этих эндпоинтов автоматически используется прокси через `/api/proxy`.

## Проверка

1. Откройте приложение
2. Откройте консоль (F12)
3. Проверьте, что нет ошибок 403 для публичных эндпоинтов
4. Для приватных эндпоинтов - убедитесь, что вы авторизованы через Telegram

## Если все еще есть ошибки 403

1. **Проверьте авторизацию:**
   - Убедитесь, что вы авторизованы через Telegram
   - Проверьте, что cookie `tg_session` установлен

2. **Проверьте бекенд:**
   - Убедитесь, что бекенд доступен по адресу `https://loyaltymarket.ru:7890`
   - Проверьте, что CORS настроен правильно

3. **Проверьте переменные окружения:**
   - Убедитесь, что `.env.local` содержит правильный URL

